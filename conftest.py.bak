import pytest
from selenium import webdriver

@pytest.fixture
def driver(request):
    driver = webdriver.Chrome()
    yield driver
    # This block runs after the test is done
    if hasattr(request.node, "rep_call") and request.node.rep_call.failed:
        screenshot_name = f"screenshots/{request.node.name}.png"
        driver.save_screenshot(screenshot_name)
        print(f"Screenshot saved to {screenshot_name}")
    driver.quit()


# This hook stores test report results on the test node
@pytest.hookimpl(tryfirst=True, hookwrapper=True)
def pytest_runtest_makereport(item, call):
    # Run all other hooks and get the report object
    outcome = yield
    rep = outcome.get_result()

    # Save the result for use in the fixture
    if rep.when == "call":
        setattr(item, "rep_call", rep)
